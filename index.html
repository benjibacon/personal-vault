// Add this to setupEventListeners() after the search event listener:
// Export
document.getElementById('exportBtn').addEventListener('click', () => this.exportToObsidian());

// Add these functions after deleteNote():

exportToObsidian() {
    const notes = JSON.parse(localStorage.getItem('vault_notes')) || [];
    
    if (notes.length === 0) {
        this.showToast('No notes to export', 'error');
        return;
    }

    // Group notes by category
    const categories = {};
    notes.forEach(note => {
        if (!categories[note.category]) {
            categories[note.category] = [];
        }
        
        const filename = this.sanitizeFilename(note.title) + '.md';
        const content = this.formatForObsidian(note);
        
        categories[note.category].push({ filename, content });
    });

    // Create export data
    const exportData = {
        exportDate: new Date().toISOString(),
        totalNotes: notes.length,
        structure: categories
    };

    // Download as JSON
    const exportJson = JSON.stringify(exportData, null, 2);
    const blob = new Blob([exportJson], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `PersonalVault_Export_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    this.showToast(`Exported ${notes.length} notes`, 'success');
}

sanitizeFilename(title) {
    return title.replace(/[^a-z0-9]/gi, '_').toLowerCase();
}

formatForObsidian(note) {
    let content = `# ${note.title}\n\n`;
    content += `**Category:** [[${note.category}]]\n`;
    content += `**Created:** ${new Date(note.timestamp).toLocaleDateString()}\n`;
    
    if (note.tags.length > 0) {
        content += `**Tags:** ${note.tags.map(tag => `#${tag}`).join(' ')}\n`;
    }
    
    content += `\n---\n\n`;
    content += note.content;
    
    if (note.type === 'image' && note.imageData && note.imageData.ocrText) {
        content += `\n\n**Image Text:** ${note.imageData.ocrText}`;
    }
    
    return content;
}
